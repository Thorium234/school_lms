{% extends 'base.html' %}
{% block title %}Book List{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="text-center mb-4">
    <h2 class="fw-bold mb-3">Welcome, {{ user.username }}</h2>
    <div class="d-flex justify-content-center flex-wrap gap-2">
      <a href="{% url 'book_create' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Add New Book</a>
      <button class="btn btn-secondary" id="printBtn"><i class="fas fa-print"></i> Print Table</button>
    </div>
  </div>

  {% include 'includes/book_search_form.html' %}

  {% if book %}
  <div class="table-responsive" id="bookTableWrapper">
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">Picture</th>
          <th scope="col">Title</th>
          <th scope="col">Publisher</th>
          <th scope="col">Published</th>
          <th scope="col">ISBN</th>
          <th scope="col">Book No.</th>
          <th scope="col">Category</th>
          <th scope="col">Shelf</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for book in book %}
        <tr>
          <td>
            {% if book.book_picture %}
            <img src="{{ book.book_picture.url }}" alt="{{ book.title }}" class="rounded shadow-sm" style="width:70px;height:90px;object-fit:cover;">
            {% else %}
            <div class="bg-secondary text-white text-center rounded" style="width:70px;height:90px;display:flex;align-items:center;justify-content:center;">No<br>Image</div>
            {% endif %}
          </td>
          <td>{{ book.title }}</td>
          <td>{{ book.publishers }}</td>
          <td>{{ book.first_publication }}</td>
          <td>{{ book.ISBN }}</td>
          <td>{{ book.book_number }}</td>
          <td>{{ book.category }}</td>
          <td>{{ book.shelf.shelf_name }}</td>
          <td>
            <div class="d-flex gap-2">
              <a href="{% url 'book_detail' book.pk %}" class="btn btn-info btn-sm">View</a>
              <a href="{% url 'book_edit' book.pk %}" class="btn btn-warning btn-sm">Edit</a>
              <a href="{% url 'book_delete' book.pk %}" class="btn btn-danger btn-sm" onclick="return confirm('Delete?')">Delete</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info text-center shadow-sm">
    There are no books yet added{% if request.GET.q %} or matching your search{% endif %}.
  </div>
  {% endif %}
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  document.getElementById("printBtn").onclick = function() {
    let table = document.getElementById("bookTableWrapper") ? document.getElementById("bookTableWrapper").innerHTML : '<div class="alert alert-info text-center">No books found.</div>';
    let win = window.open('', '', 'height=650,width=950');
    win.document.write('<html><head><title>Book Table</title><link rel="stylesheet" href="/static/css/bootstrap.min.css"></head><body>');
    win.document.write('<div class="container mt-4">' + table + '</div>');
    win.document.write('</body></html>');
    win.document.close();
    win.focus();
    win.print();
    win.close();
  };
});
</script>
{% endblock %}