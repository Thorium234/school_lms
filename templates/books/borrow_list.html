{% extends 'base.html' %}
{% block title %}Book Borrows{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-4 gap-2">
    <h2 class="fw-bold">Book Borrows</h2>
    <a href="{% url 'borrow_book' %}" class="btn btn-primary"><i class="fas fa-plus"></i> New Borrow</a>
  </div>

  <!-- Recent borrows list stays -->
  ...
  <!-- Active borrows cards -->
  <div class="row g-3">
    {% for borrow in active_borrows %}
    <div class="col-sm-12 col-md-6">
      <div class="card mb-3 shadow-sm {% if borrow.is_overdue %}border-danger{% endif %}">
        <div class="card-body">
          <h5 class="card-title">{{ borrow.book.title }}</h5>
          <p class="card-text small mb-1">Book No.: {{ borrow.book.book_number }}, ISBN: {{ borrow.book.ISBN }}</p>
          <p class="card-text">Borrowed by <strong>{{ borrow.student.first_name }} {{ borrow.student.last_name }}</strong> (Adm: {{ borrow.student.admission_number }}, {{ borrow.student.room.form }} {{ borrow.student.room.stream }})</p>
          <p class="card-text small">Borrowed: {{ borrow.borrowed_date|date:"M d, Y" }} | Due: {{ borrow.due_date|date:"M d, Y" }}</p>
          <span class="badge {% if borrow.is_overdue %}bg-danger{% else %}bg-warning text-dark{% endif %}">
            {% if borrow.is_overdue %}Overdue ({{ borrow.days_overdue }}d){% else %}Borrowed{% endif %}
          </span>
          <div class="mt-3">
            <a href="{% url 'return_book' borrow.id %}" class="btn btn-success btn-sm me-1"><i class="fas fa-book"></i> Return</a>
            <form method="post" action="{% url 'abort_borrow' borrow.pk %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Abort?')"><i class="fas fa-ban"></i> Abort</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info text-center">No active borrows</div>
    </div>
    {% endfor %}
  </div>

  <!-- Recently returned can stay as list or converted similarly -->
</div>
{% endblock %}
